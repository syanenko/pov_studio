<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js)
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3PHDJG8H9Y"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-3PHDJG8H9Y');
    </script>
    -->
    <title>all2pov</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
<!--
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="expires" content="timestamp">
-->
    <link type="text/css" rel="stylesheet" href="main.css">
  </head>

  <body>
    <script type="importmap"> { 
      "imports": { 
        "three": "/node_modules/three/build/three.module.js",
        "three/addons/": "/node_modules/three/examples/jsm/",
        "three/nodes": "/node_modules/three/examples/jsm/nodes/Nodes.js"
        } 
    }
    </script> 

    <img id="logo" src="data/images/logo_40x40.png" alt="Logo" width="40" height="40" onclick="window.open('https://www.povray.org', '_blank')">
    <div id="text" onclick="about.showModal()">POV-Ray converter</div>
    <img id="help" src="data/images/help.png" alt="Help" onclick="about.inert=true;  about.showModal(); about.inert=false;">
    <hr>

    <!-- About -->
    <dialog id="about" style="width:450px">
      <div style="font-size: 24px; color:#ff9127">POV-Ray converter</div>
      <p>Converts obj, fbx, glb, gltf, stl formats to mesh2.</p>
      <a href="https://yesbird.online/">Yesbird studio</a></p>
      <form method="dialog" style="text-align:center">
        <button>&nbsp;&nbsp;&nbsp;OK&nbsp;&nbsp;&nbsp;</button>
      </form>
    </dialog>

    <!-- Main -->
    <script type="module" src="main.js"></script>
 
    <!-- Upload model -->
    <div id="form_upload" style="width:370px">
      <form encType="multipart/form-data" style="text-align:left">
        <h3>Upload model (obj,fbx,glb,gltf,stl)</h3>
        <input type="file" name="model"  accept=".obj,.fbx,.glb,.gltf,.stl"/><br/><br/>
        <input type="submit"  value="Upload" />&nbsp;&nbsp;&nbsp;&nbsp;
        <input type="button"  value="Cancel" onclick="parentElement.parentElement.style.visibility = 'hidden'"/>
      </form>
    </div>

    <script>
      var form = document.getElementById('form_upload');

      // Add a submit event listener to the form
      form.addEventListener('submit', function(e) {
        // Prevent the default form submission behavior
        e.preventDefault();

        // Create a new FormData object
        var formData = new FormData();

        // Get the selected file
        var model   = form.querySelector('[name="model"]'  ).files[0];

        // Add the file to the FormData object
        formData.append('model',   model);

        // XMLHttpRequest object
        var xhr = new XMLHttpRequest();

        // Set the request url - check it before publishing
        xhr.open('POST', 'http://localhost:8085/upload.php');
        // xhr.open('POST', 'https://povlab.yesbird.online/all2pov/upload.php');

        // Set the request onload event listener
        xhr.responseType = 'json';
        xhr.onload = function() {
          if (xhr.status === 200) {
            window.loadModel(xhr.response);
          } else {
            console.error(xhr.response);
          }
        }
        // Send the request
        xhr.send(formData);
        form.style.visibility = 'hidden';
      });
    </script>

    <!-- Model -->
    <div id="container"></div>
    <!-- Controls -->
    <div style='position: absolute; top:65px; left:20px; width:90px; z-index:4;'>
      <input id="upload_button"   type="image" src='data/images/upload_icon.png'   style='position: relative; padding-top: 15px;'>
      <input id="download_button" type="image" src='data/images/download_icon.png' onclick="window.download()" style='position: relative; padding-top: 5px;'>

    </div>

    <script>
      ub = document.getElementById("upload_button");
      ub.onclick = function() { let form = document.getElementById("form_upload");
                                form.style.visibility == "visible" ? form.style.visibility = 'hidden': form.style.visibility = "visible"; }
    </script>

    <div style='position: absolute; top:65px; right:20px; width:90px; z-index:4;'>
      <input id="glaze1"  type="image" src='data/mat/skeleton_icon.png' style='position: relative;  margin: 3px;'>
      <input id="glaze2"  type="image" src='data/mat/sculpty_icon.png'  style='position: relative;  margin: 3px;'>
      <input id="glaze3"  type="image" src='data/mat/sunny_icon.png'    style='position: relative;  margin: 3px;'>
      <input id="glaze4"  type="image" src='data/mat/glassy_icon.png'   style='position: relative;  margin: 3px;'>
      <input id="glaze5"  type="image" src='data/mat/normal_icon.png'   style='position: relative;  margin: 3px;'>
    </div>

    <script>
      document.getElementById("glaze1").onclick = function() { window.applyGlaze('skeleton'); }
      document.getElementById("glaze2").onclick = function() { window.applyGlaze('sculpty'); }
      document.getElementById("glaze3").onclick = function() { window.applyGlaze('sunny'); }
      document.getElementById("glaze4").onclick = function() { window.applyGlaze('glassy'); }
      document.getElementById("glaze5").onclick = function() { window.applyGlaze('normal'); }
    </script>

    <!-- Settings -->
    <div style='position: absolute; bottom:15px; left:20px; z-index:4; font-size: 130%;'>
      <input type="checkbox" id="flat_shading" onclick="window.flatShading(this.checked)">
      <label for="flat_shading">Flat shading</label><br>

      <input type="checkbox" id="display_axis" onclick="window.displayAxis(this.checked)">
      <label for="display_axis">Display axis</label><br>

      <input type="checkbox" id="switch_normals" onclick="window.switchNormals(this.checked)">
      <label for="switch_normals">Display normals</label><br>

      <!--
      <input type="checkbox" id="switch_rotation" onclick="window.switchRotation(this.checked)">
      <label for="switch_rotation">Rotation</label><br>

      <input type="checkbox" id="export_array" onclick="window.flatShading(this.checked)">
      <label for="export_array">Export array</label><br>
      -->
    </div>

  </body>
</html>
